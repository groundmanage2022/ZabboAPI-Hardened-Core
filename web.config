<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <modules>
            <remove name="WebDAVModule" />
        </modules>
        <rewrite>
            <rules>
                <rule name="Online Count">
                    <match url="^onlinecount$" ignoreCase="false" />
                    <action type="Rewrite" url="onlinecount.php" appendQueryString="false" />
                </rule>
            </rules>
            <outboundRules>
                <rule name="Add CORS Headers">
                    <match serverVariable="RESPONSE_Access-Control-Allow-Origin" pattern=".*" />
                    <action type="Rewrite" value="*" />
                </rule>
                <rule name="Add CORS Methods">
                    <match serverVariable="RESPONSE_Access-Control-Allow-Methods" pattern=".*" />
                    <action type="Rewrite" value="GET, POST, PUT, DELETE, OPTIONS, HEAD" />
                </rule>
                <rule name="Add CORS Headers Allowed">
                    <match serverVariable="RESPONSE_Access-Control-Allow-Headers" pattern=".*" />
                    <action type="Rewrite" value="Content-Type, Authorization, X-Requested-With, Accept, Origin" />
                </rule>
            </outboundRules>
        </rewrite>
        <security>
            <requestFiltering allowDoubleEscaping="true">
                <verbs allowUnlisted="true">
                    <add verb="OPTIONS" allowed="true" />
                    <add verb="GET" allowed="true" />
                    <add verb="POST" allowed="true" />
                    <add verb="PUT" allowed="true" />
                    <add verb="DELETE" allowed="true" />
                    <add verb="HEAD" allowed="true" />
                </verbs>
                <hiddenSegments>
                    <add segment="config.php" />
                </hiddenSegments>
                <denyUrlSequences>
                    <add sequence=".git" />
                    <add sequence=".env" />
                    <add sequence=".htaccess" />
                </denyUrlSequences>
                <fileExtensions>
                    <add fileExtension=".bak" allowed="false" />
                    <add fileExtension=".log" allowed="false" />
                </fileExtensions>
                <requestLimits maxQueryString="8192" maxUrl="8192" />
            </requestFiltering>
        </security>
        <httpProtocol>
            <customHeaders>
                <add name="Access-Control-Allow-Origin" value="*" />
                <add name="Access-Control-Allow-Methods" value="GET, POST, PUT, DELETE, OPTIONS, HEAD" />
                <add name="Access-Control-Allow-Headers" value="Content-Type, Authorization, X-Requested-With, Accept, Origin" />
                <add name="Access-Control-Max-Age" value="86400" />
                <add name="X-Content-Type-Options" value="nosniff" />
                <add name="X-Frame-Options" value="SAMEORIGIN" />
                <add name="X-XSS-Protection" value="1; mode=block" />
                <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
            </customHeaders>
        </httpProtocol>
        <httpErrors errorMode="Detailed" existingResponse="PassThrough" />
        <defaultDocument>
            <files>
                <clear />
                <add value="index.php" />
                <add value="index.html" />
                <add value="Default.htm" />
            </files>
        </defaultDocument>
    </system.webServer>
</configuration>